using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;

namespace MalwareAnalysisGUI
{
    class StringsTool : AnalysisEngineTool
    {

        const string StringsEXEName = @"Resources\strings.exe";

        private Process process;

        public StringsTool()
        {
            this.Description = "StringsTool";
        }

        public override void Analyze(Sample s)
        {

            Console.WriteLine(s.FileName);

            ProcessStartInfo psi = new ProcessStartInfo();
            psi.Arguments = s.FullPath;
            psi.FileName = StringsEXEName;
            psi.UseShellExecute = false;
            psi.RedirectStandardOutput = true;

            process = Process.Start(psi);

            StringBuilder sb = new StringBuilder();
            while (process.HasExited == false)
            {
                sb.Append(process.StandardOutput.ReadToEnd());
            }

            sb.Append(process.StandardOutput.ReadToEnd());
            
            this.Result = sb.ToString();
            
        }

        public override void Dispose()
        {
            try
            {
                process.Kill();
            }
            catch (Exception)
            {
                
            }
        }
    }
}
